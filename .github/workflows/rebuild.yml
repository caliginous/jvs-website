name: Rebuild JVS Website (Legacy - Use Specific Workflows)

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production
      user:
        description: 'User who triggered the rebuild'
        required: true
        default: 'webhook'
      reason:
        description: 'Reason for rebuild'
        required: false
        default: 'Content release'
  repository_dispatch:
    types: [wordpress_update]

jobs:
  dispatch-rebuild:
    runs-on: ubuntu-latest
    
    steps:
    - name: Trigger Staging Rebuild
      if: github.event.inputs.environment == 'staging' || github.event_name == 'repository_dispatch'
      uses: actions/github-script@v7
      with:
        script: |
          await github.rest.actions.createWorkflowDispatch({
            owner: context.repo.owner,
            repo: context.repo.repo,
            workflow_id: 'rebuild-staging.yml',
            ref: 'main',
            inputs: {
              user: '${{ github.event.inputs.user || "webhook" }}',
              reason: '${{ github.event.inputs.reason || "WordPress content update" }}'
            }
          });
          
    - name: Trigger Production Rebuild
      if: github.event.inputs.environment == 'production'
      uses: actions/github-script@v7
      with:
        script: |
          await github.rest.actions.createWorkflowDispatch({
            owner: context.repo.owner,
            repo: context.repo.repo,
            workflow_id: 'rebuild-production.yml',
            ref: 'main',
            inputs: {
              user: '${{ github.event.inputs.user }}',
              reason: '${{ github.event.inputs.reason }}',
              run_tests: 'true'
            }
          });
          
    - name: Notify dispatch
      run: |
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          echo "ğŸš€ Triggered ${{ github.event.inputs.environment }} rebuild"
          echo "ğŸ‘¤ User: ${{ github.event.inputs.user }}"
          echo "ğŸ“ Reason: ${{ github.event.inputs.reason }}"
        else
          echo "ğŸš€ Triggered staging rebuild from WordPress webhook"
          echo "ğŸ‘¤ User: webhook"
          echo "ğŸ“ Reason: WordPress content update"
        fi 